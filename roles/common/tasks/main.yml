---
# This playbook contains common plays that will be run on all nodes.


- name:  set enforce 0
  shell: set enforce 0 

- name:  set selinux disable
  template: src=selinux.conf dest=/etc/selinux/config

- name: stop firewalld
  service: name=firewalld state=stopped enabled=no

- name: clear iptables
  service: name=iptables state=stopped enabled=no

- name:  set file-max
  template: src=sysctl.conf dest=/etc/sysctl.conf

- name: set yum cache
  template: src=yum.conf dest=/etc/yum.conf

- name:  set ulimit
  template: src=limits.conf  dest=/etc/security/limits.conf

- name:  set disk model
  template: src=99-trunkey.rules  dest=/usr/lib/udev/rules.d/99-trunkey.rules

- name:  set centos repo
  template: src=Centos-7.repo  dest=/etc/yum.repos.d/Centos-7.repo

- name:  set epel repo
  template: src=epel-7.repo  dest=/etc/yum.repos.d/epel-7.repo

- name:  set ceph repo
  template: src=ceph.repo  dest=/etc/yum.repos.d/ceph.repo

- name: Install ntp
  yum: name=ntp state=latest

- name: Install ceph
  yum:  name=ceph state=latest

- name: Configure ntp file
  template: src=ntp.conf.j2 dest=/etc/ntp/ntp.conf
  notify: restart ntp

- name: Start the ntp service
  service: name=ntpd state=started enabled=yes

- name: format disk
  script: ./roles/osd/scripts/fortmat.sh  {{ansible_nodename}} {{item}} 20
  with_ini: disk* section={{ansible_nodename}} file=disk.ini re=true
